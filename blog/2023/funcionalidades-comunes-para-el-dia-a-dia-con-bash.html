<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Te comparto unas cuantas funciones
y combinaciones de comandos de operaciones que se repiten en el tiempo
cuando trabajamos en una terminal" />
    <title>S3r0s4pi3ns - Funcionalidades comunes para el dia a dia con
bash</title>
    <link rel="stylesheet" href="../../styles/normalize.css" />
    <link rel="stylesheet" href="../../styles/globals.css" />
    <link rel="stylesheet" href="../../styles/article.css" />
  </head>
  <body>
    <main>
      <div class="terminal">
        <pre>
          <span class="output" data-prompt="blog/2023/funcionalidades-comunes-para-el-dia-a-dia-con-bash"><a class="terminal-link" href="/">cd &#36;HOME</a></span>
        </pre>
      </div>
      <article>
        <header>
          <h1>Funcionalidades comunes para el dia a dia con bash</h1>
                    <img src="/assets/images/stable_difussion_city.jpg" alt="article_thumbnail" />
                  </header>
      </article>
      <section><ul>
<li><a href="#colores-para-tus-textos-en-terminal">Colores para tus
textos en terminal</a></li>
<li><a href="#transformar-texto-a-mayusculas-o-minusculas">Transformar
texto a mayusculas o minusculas</a></li>
<li><a
href="#comprobar-si-una-url-es-valida-teniendo-en-cuenta-múltiples-protocolos">Comprobar
si una url es valida teniendo en cuenta múltiples protocolos</a></li>
<li><a
href="#usar-el-directorio-actual-donde-se-encuentra-alojado-el-script-y-no-donde-se-ejecuta">Usar
el directorio actual donde se encuentra alojado el script y no donde se
ejecuta</a>
<ul>
<li><a href="#importante">Importante</a></li>
</ul></li>
<li><a href="#reemplazar-sin-sacar-output-en-consola">Reemplazar sin
sacar output en consola</a></li>
<li><a
href="#reemplazar-un-bloque-especifico-de-texto-en-un-archivo">Reemplazar
un bloque especifico de texto en un archivo</a></li>
<li><a href="#añadir-nueva-linea-despues-de-un-match-con-sed">Añadir
nueva linea despues de un match con sed</a></li>
<li><a href="#convertir-una-cadena-de-texto-en-array">Convertir una
cadena de texto en array</a></li>
<li><a
href="#separar-valores-en-nueva-linea-por-multiples-delimitadores">Separar
valores en nueva linea por multiples delimitadores</a></li>
<li><a href="#leer-un-archivo-linea-por-linea">Leer un archivo linea por
linea</a></li>
<li><a href="#comprobar-si-un-usuario-existe-en-el-sistema">Comprobar si
un usuario existe en el sistema</a></li>
<li><a href="#leer-input-del-usuario">Leer input del usuario</a></li>
<li><a href="#que-gestor-de-paquetes-utilizar-segun-el-os">Que gestor de
paquetes utilizar segun el OS</a></li>
<li><a href="#que-sistema-operativo-es">Que sistema operativo
es</a></li>
<li><a href="#que-architectura-es">Que architectura es</a></li>
<li><a href="#extraer-puertos-abiertos-desde-nmap--on">Extraer puertos
abiertos desde nmap -oN</a></li>
<li><a href="#extraer-puertos-abiertos-desde-nmap--og">Extraer puertos
abiertos desde nmap -oG</a></li>
<li><a href="#parsear-argumentos-de-un-script">Parsear argumentos de un
script</a></li>
<li><a
href="#validar-que-un-parámetro-esta-en-un-rango-de-valores-validos-definidos-en-un-array">Validar
que un parámetro esta en un rango de valores validos definidos en un
array</a></li>
<li><a href="#operaciones-con-arrays-asociativos">Operaciones con arrays
asociativos</a></li>
<li><a href="#transformar-string-en-array">Transformar string en
array</a></li>
<li><a href="#convertir-string-multilinea-en-array">Convertir string
multilinea en array</a></li>
<li><a
href="#imprimir-texto-multilinea-con-sustitucion-de-variables">Imprimir
texto multilinea con sustitucion de variables</a></li>
<li><a href="#extraer-propiedades-de-un-archivo-json">Extraer
propiedades de un archivo .json</a></li>
<li><a
href="#extraer-propiedades-de-un-frontmatter-en-archivos-markdown">Extraer
propiedades de un frontmatter en archivos markdown</a></li>
<li><a
href="#reemplazar-espacios-en-blanco-por-un-caracter-definido">Reemplazar
espacios en blanco por un caracter definido</a></li>
<li><a
href="#sacando-output-a-shell-en-lugar-de-guardar-un-archivo-con-wget">Sacando
output a shell en lugar de guardar un archivo con wget</a></li>
<li><a href="#convertir-texto-a-hexadecimal">Convertir texto a
hexadecimal</a></li>
<li><a href="#fork-bomb">Fork bomb</a>
<ul>
<li><a href="#importantísimo">Importantísimo</a></li>
</ul></li>
</ul>
<p>Lo que voy a compartir es una serie de scripts en bash que pueden
reutilizarse para realizar operaciones comunes con el, es una serie de
recursos que he ido acumulando en mi notion donde voy tomando notas de
mi aprendizaje y de algunas soluciones a las que he llegado para yo
consultarlas en el futuro y seguir avanzando.</p>
<p>También suelo utilizar <a href="https://devhints.io/bash">la
cheatsheet de devhint</a> como consulta ya que es fácil no tener en la
cabeza todas las movidas de sintaxis que usa bash</p>
<h1 id="colores-para-tus-textos-en-terminal">Colores para tus textos en
terminal</h1>
<p>Ayudan a crear una mejor legibilidad de nuestros scripts en consola
cuando queremos enfatizar cierta información o mostrar un error, la
forma normal que uso yo es con los códigos de escape ANSI:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="va">greenColour</span><span class="op">=</span><span class="st">&#39;\033[0;32m&#39;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="va">redColour</span><span class="op">=</span><span class="st">&#39;\033[0;31m&#39;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="va">blueColour</span><span class="op">=</span><span class="st">&#39;\033[0;34m&#39;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="va">yellowColour</span><span class="op">=</span><span class="st">&#39;\033[1;33m&#39;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="va">purpleColour</span><span class="op">=</span><span class="st">&#39;\033[0;35m&#39;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="va">cyanColour</span><span class="op">=</span><span class="st">&#39;\033[0;36m&#39;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="va">grayColour</span><span class="op">=</span><span class="st">&#39;\033[0;37m&#39;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset de color</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="va">endColour</span><span class="op">=</span><span class="st">&#39;\033[0m&#39;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Cuando uso la variable entre {} es para que interprete solo esa parte y no se superponga con el texto que viene</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Si usara $redColour[ ABORTING ] tomaría los ultimos caracteres como parte de la variable</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${redColour}</span><span class="st">[ ABORTING ]</span><span class="va">$endColour</span><span class="st"> </span><span class="va">${yellowColour}</span><span class="st">GNU grep is required. Install it with</span><span class="va">$endColour</span><span class="st"> </span><span class="va">${cyanColour}</span><span class="st">&#39;brew install grep&#39;</span><span class="va">$endColour</span><span class="st">&quot;</span> <span class="op">&gt;&amp;</span><span class="dv">2</span></span></code></pre></div>
<p>Puedes encontrar la lista completa en <a
href="https://gist.github.com/Prakasaka/219fe5695beeb4d6311583e79933a009">https://gist.github.com/Prakasaka/219fe5695beeb4d6311583e79933a009</a></p>
<h1 id="transformar-texto-a-mayusculas-o-minusculas">Transformar texto a
mayusculas o minusculas</h1>
<p>En ciertos momentos necesito realizar esta transformación por ‘x’
motivo, aqui te dejo el procedimiento:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Con tr</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;FANTASMAGORICO&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span> <span class="co"># fantasmagorico</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;fantasmAgoRico&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:lower:]&#39;</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="co"># FANTASMAGORICO</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Con simbolos de manipulacion</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">${FAntaSmagoRico</span><span class="op">,,</span><span class="va">}</span><span class="st">&quot;</span>  <span class="co">#=&gt; &quot;fantasmagorico&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">${fantasmagorico</span><span class="op">^^</span><span class="va">}</span><span class="st">&quot;</span>  <span class="co">#=&gt; &quot;FANTASMAGORICO&quot;</span></span></code></pre></div>
<h1
id="comprobar-si-una-url-es-valida-teniendo-en-cuenta-múltiples-protocolos">Comprobar
si una url es valida teniendo en cuenta múltiples protocolos</h1>
<p>Una funcion que siempre tengo en el tipico <code>utils.sh</code>
cuando trabajo con direcciones y múltiples protocolos. Si necesitas solo
trabajar con el protocolo Http simplemente elimina los otros y ya:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_url()</span> <span class="kw">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">url</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">regex</span><span class="op">=</span><span class="st">&#39;(https?|ftp|file)://[-[:alnum:]\+&amp;@#/%?=~_|!:,.;]*[-[:alnum:]\+&amp;@#/%=~_|]&#39;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">[[</span> <span class="va">$url</span> <span class="ot">=~</span> <span class="va">$regex</span> <span class="kw">]]</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h1
id="usar-el-directorio-actual-donde-se-encuentra-alojado-el-script-y-no-donde-se-ejecuta">Usar
el directorio actual donde se encuentra alojado el script y no donde se
ejecuta</h1>
<p>Cuando usas <code>$(pwd)</code> en tu script de bash realmente esta
utilizando el path donde lo estas ejecutando, muchas veces no nos
importa pero hay momentos en los que necesito que el script trabaje en
el directorio donde se encuentra para saber donde encontrar archivos en
una estructura estática y usar path relativos de forma correcta:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">CURRENT_DIR</span><span class="op">=</span><span class="va">$(</span><span class="fu">dirname</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">readlink</span> <span class="at">-f</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$BASH_SOURCE</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span><span class="va">)</span></span></code></pre></div>
<h2 id="importante">Importante</h2>
<p>Esta linea se tiene que aplicar en cada script individual ya que si
por ejemplo creamos un fichero <code>utils.sh</code> en otro directorio
con esta funcion y la exportamos no funcionara como esperamos:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># project/helpers/utils.sh</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">current_directory()</span> <span class="kw">{</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>		<span class="fu">dirname</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">readlink</span> <span class="at">-f</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$BASH_SOURCE</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="at">-f</span> <span class="va">current_directory</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">################</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># projects/install.sh</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> <span class="st">&quot;helpers/utils.sh&quot;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># La ejecución de la funcion nos dará el path de project/helpers y no projects/</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="va">CURRENT_DIR</span><span class="op">=</span>current_directory</span></code></pre></div>
<h1 id="reemplazar-sin-sacar-output-en-consola">Reemplazar sin sacar
output en consola</h1>
<p>Reemplazos sencillos en los que no quiero que <code>sed</code> me
saque el output del archivo en pantalla:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-i</span> <span class="at">-e</span> <span class="st">&quot;s/match/replace/g&quot;</span> file</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># En sistemas MacOs hay que definir el string vacio</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-i</span> <span class="st">&#39;&#39;</span> <span class="at">-e</span> <span class="st">&quot;s/match/replace/g&quot;</span> file</span></code></pre></div>
<h1
id="reemplazar-un-bloque-especifico-de-texto-en-un-archivo">Reemplazar
un bloque especifico de texto en un archivo</h1>
<p>En mi repositorio de <a
href="https://github.com/s3r0s4pi3ns/bash-static-blog">bash-static-blog</a>
utilizo esta técnica para generar el indice de los articulos en el
index.html en un bloque específico del mismo que he definido con las
palabras START Y END:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># index.html</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>div<span class="op">&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;</span>ul<span class="op">&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>!-- <span class="ex">START</span> <span class="at">--</span><span class="op">&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>!-- <span class="ex">END</span> <span class="at">--</span><span class="op">&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;</span>/ul<span class="op">&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>/div<span class="op">&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># bash</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-i</span> <span class="st">&#39;&#39;</span> <span class="at">-e</span> <span class="st">&quot;/&lt;!-- START --&gt;/,/&lt;!-- END --&gt;/c</span><span class="dt">\\</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;!-- START --&gt;</span><span class="dt">\\</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="va">$html</span><span class="dt">\\</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;!-- END --&gt;&quot;</span> <span class="st">&quot;</span><span class="va">$index_html_file</span><span class="st">&quot;</span></span></code></pre></div>
<h1 id="añadir-nueva-linea-despues-de-un-match-con-sed">Añadir nueva
linea despues de un match con sed</h1>
<p>El procedimiento es simple pero tener que escapar los backslashes la
hace mas pesada de leer:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/sudoers</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">//...</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Defaults</span> use_pty</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-i</span> <span class="st">&#39;&#39;</span> <span class="st">&#39;/use_pty/s/.*/&amp;\nDefaults logfile=&quot;\/var\/log\/sudo.log&quot;/&#39;</span> /etc/sudoers</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/sudoers</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ex">//...</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Defaults</span> use_pty</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Defaults</span> logfile=<span class="st">&quot;/var/log/sudo.log&quot;</span></span></code></pre></div>
<h1 id="convertir-una-cadena-de-texto-en-array">Convertir una cadena de
texto en array</h1>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">local</span> <span class="va">$ALLOWED_USERS</span>=<span class="st">&quot;juan mario magdalena&quot;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ot">! </span><span class="ex">is_empty</span> <span class="st">&quot;</span><span class="va">$ALLOWED_USERS</span><span class="st">&quot;</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>      <span class="bu">read</span> <span class="at">-ra</span> <span class="va">names</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">&quot;</span><span class="va">$ALLOWED_USERS</span><span class="st">&quot;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> name <span class="kw">in</span> <span class="st">&quot;</span><span class="va">${names</span><span class="op">[@]</span><span class="va">}</span><span class="st">&quot;</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>	       <span class="co"># do your stuff here</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">done</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<h1
id="separar-valores-en-nueva-linea-por-multiples-delimitadores">Separar
valores en nueva linea por multiples delimitadores</h1>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="va">DOMAINS</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;example.com,example.es|hola.org:adios.es 10000.net&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;,|-_/: &#39;</span> <span class="st">&#39;\n&#39;</span><span class="va">)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$DOMAINS</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">example.com</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="ex">example.es</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="ex">hola.org</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="ex">adios.es</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ex">10000.net</span></span></code></pre></div>
<h1 id="leer-un-archivo-linea-por-linea">Leer un archivo linea por
linea</h1>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">IFS</span><span class="op">=</span>read <span class="ex">line</span><span class="kw">;</span> <span class="cf">do</span> <span class="op">&lt;</span>command<span class="op">&gt;</span><span class="kw">;</span> <span class="cf">done</span> <span class="op">&lt;</span> file.txt</span></code></pre></div>
<h1 id="comprobar-si-un-usuario-existe-en-el-sistema">Comprobar si un
usuario existe en el sistema</h1>
<p>Estoy empezando usar el comando <code>id</code> ya que en la man page
de <code>whoami</code> podemos encontrar el siguiente apartado:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> whoami utility has been obsoleted by the id<span class="er">(</span><span class="ex">1</span><span class="kw">)</span> <span class="ex">utility,</span> and is equivalent to “id <span class="at">-un”.</span>  The command “id <span class="at">-p”</span> is suggested for normal interactive use.</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="va">name</span><span class="op">=</span>eusebio</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ot">! </span><span class="fu">id</span> <span class="at">-u</span> <span class="st">&quot;</span><span class="va">$name</span><span class="st">&quot;</span> <span class="dv">1</span><span class="op">&gt;</span>/dev/null<span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>	  <span class="co"># The user does not exist...</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<h1 id="leer-input-del-usuario">Leer input del usuario</h1>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">declare</span> <span class="at">-i</span> <span class="va">number</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">$number</span> ~= <span class="st">&#39;^[0-9]+$&#39;</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>	<span class="bu">read</span> <span class="at">-rp</span> <span class="st">&quot;Selecciona un numero&quot;</span> <span class="va">number</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<h1 id="que-gestor-de-paquetes-utilizar-segun-el-os">Que gestor de
paquetes utilizar segun el OS</h1>
<p>Una version rudimentaria para determinar que gestor de paquetes
utilizar si queremos instalar dependencias en nuestro script</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> whichPM()</span> <span class="kw">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">package_manager</span><span class="op">=</span><span class="st">&#39;&#39;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>		<span class="co"># MacOS</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="va">$OSTYPE</span> <span class="ot">==</span> <span class="st">&#39;darwin&#39;</span><span class="pp">*</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">package_manager</span><span class="op">=</span><span class="st">&#39;brew&#39;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ubuntu, Debian and Linux mint</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">[</span> <span class="ot">-n</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">command</span> <span class="at">-v</span> apt<span class="va">)</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>			<span class="va">package_manager</span><span class="op">=</span><span class="st">&quot;apt&quot;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CentOS, RHEL and Fedora</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">[</span> <span class="ot">-n</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">command</span> <span class="at">-v</span> yum<span class="va">)</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>			<span class="va">package_manager</span><span class="op">=</span><span class="st">&quot;yum&quot;</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">[</span> <span class="ot">-n</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">command</span> <span class="at">-v</span> dnf<span class="va">)</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>			<span class="va">package_manager</span><span class="op">=</span><span class="st">&quot;dnf&quot;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Arch Linux and Manjaro Systems</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">[</span> <span class="ot">-n</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">command</span> <span class="at">-v</span> pacman<span class="va">)</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>			<span class="va">package_manager</span><span class="op">=</span><span class="st">&quot;pacman&quot;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># OpenSuse systems</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">[</span> <span class="ot">-n</span> <span class="st">&quot;</span><span class="va">$(</span><span class="bu">command</span> <span class="at">-v</span> zypper<span class="va">)</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>			<span class="va">package_manager</span><span class="op">=</span><span class="st">&quot;zypper&quot;</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>      <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;Package manager not found (apt,yum,dnf,pacman or zypper)&quot;</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>      <span class="bu">exit</span> 1<span class="kw">;</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$package_manager</span><span class="st">&quot;</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="at">-f</span> <span class="va">whichPM</span></span></code></pre></div>
<h1 id="que-sistema-operativo-es">Que sistema operativo es</h1>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> whichOS()</span> <span class="kw">{</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">operating_system</span><span class="op">=</span><span class="st">&#39;&#39;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="va">$OSTYPE</span> <span class="ot">==</span> <span class="st">&#39;darwin&#39;</span><span class="pp">*</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>       <span class="va">operating_system</span><span class="op">=</span><span class="st">&quot;macOS&quot;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">expr</span> substr <span class="va">$(</span><span class="fu">uname</span> <span class="at">-s</span><span class="va">)</span> 1 5<span class="va">)</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;Linux&quot;</span> <span class="bu">]</span> <span class="kw">||</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">uname</span><span class="va">)</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;cygwin&quot;</span>]<span class="er">;</span> <span class="er">then</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>       <span class="va">operating_system</span><span class="op">=</span><span class="st">&quot;linux&quot;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">expr</span> substr <span class="va">$(</span><span class="fu">uname</span> <span class="at">-s</span><span class="va">)</span> 1 10<span class="va">)</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;MINGW32_NT&quot;</span> <span class="bu">]</span> <span class="kw">||</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">expr</span> substr <span class="va">$(</span><span class="fu">uname</span> <span class="at">-s</span><span class="va">)</span> 1 10<span class="va">)</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;MINGW64_NT&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>       <span class="va">operating_system</span><span class="op">=</span><span class="st">&quot;windows&quot;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>	    <span class="bu">exit</span> 1<span class="kw">;</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$operating_system</span><span class="st">&quot;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="at">-f</span> <span class="va">whichOS</span></span></code></pre></div>
<h1 id="que-architectura-es">Que architectura es</h1>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="va">system_architecture</span><span class="op">=</span><span class="va">$(</span><span class="fu">uname</span> <span class="at">-m</span><span class="va">)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="va">$system_architecture</span> <span class="kw">in</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="ss">arm64</span> <span class="kw">|</span> <span class="ss">aarch64</span><span class="kw">)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="va">kitty_release</span><span class="op">=</span><span class="st">&quot;kitty-0.27.1-arm64.txz&quot;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="ss">64-bit</span> <span class="kw">|</span> <span class="ss">x86_64</span><span class="kw">)</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="va">kitty_release</span><span class="op">=</span><span class="st">&quot;kitty-0.27.1-x86_64.txz&quot;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="ss">i386</span><span class="kw">|</span> <span class="ss">i486</span><span class="kw">|</span> <span class="ss">i586</span><span class="kw">|</span> <span class="ss">i686</span><span class="kw">)</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">kitty_release</span><span class="op">=</span><span class="st">&quot;kitty-0.27.1-i686.txz&quot;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">esac</span></span></code></pre></div>
<h1 id="extraer-puertos-abiertos-desde-nmap--on">Extraer puertos
abiertos desde nmap -oN</h1>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>  <span class="bu">[</span> <span class="ot">!</span> <span class="va">$#</span> <span class="ot">-eq</span> 0 <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="va">$file</span> <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">[</span> <span class="ot">-s</span> <span class="va">$file</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>	<span class="fu">grep</span> <span class="at">-E</span> <span class="st">&#39;[0-9]{1,5}/(tcp|udp)&#39;</span> <span class="va">$file</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="at">-r</span> <span class="st">&#39;s/\/(tcp|udp)//g&#39;</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1}&#39;</span> <span class="kw">|</span> <span class="fu">xargs</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39; &#39;</span> <span class="st">&#39;,&#39;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="at">-d</span> <span class="st">&#39;\n&#39;</span> <span class="kw">|</span> <span class="ex">xclip</span> <span class="at">-sel</span> clip</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>	<span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;The file passed as parameter does not exists or is not valid&quot;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<h1 id="extraer-puertos-abiertos-desde-nmap--og">Extraer puertos
abiertos desde nmap -oG</h1>
<p>Este script lo he sacado de un gist de <a
href="https://gist.github.com/anibalardid/5e05b6472feb3d31116729dc24e6d3e2">s4vitar</a>
y lo suelo combinar con el anterior dependiendo en que formato saco el
output del escaneo de nmap</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="va">ports</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">cat</span> <span class="va">$1</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-oP</span> <span class="st">&#39;\d{1,5}/open&#39;</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1}&#39;</span> FS=<span class="st">&#39;/&#39;</span> <span class="kw">|</span> <span class="fu">xargs</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39; &#39;</span> <span class="st">&#39;,&#39;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>	<span class="va">ip_address</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">cat</span> <span class="va">$1</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-oP</span> <span class="st">&#39;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}&#39;</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-u</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 1<span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>	<span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n[*] Extracting information...\n&quot;</span> <span class="op">&gt;</span> extractPorts.tmp</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>	<span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\t[*] IP Address: </span><span class="va">$ip_address</span><span class="st">&quot;</span>  <span class="op">&gt;&gt;</span> extractPorts.tmp</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>	<span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\t[*] Open ports: </span><span class="va">$ports</span><span class="st">\n&quot;</span>  <span class="op">&gt;&gt;</span> extractPorts.tmp</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>	<span class="bu">echo</span> <span class="va">$ports</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="at">-d</span> <span class="st">&#39;\n&#39;</span> <span class="kw">|</span> <span class="ex">xclip</span> <span class="at">-sel</span> clip</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>	<span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;[*] Ports copied to clipboard\n&quot;</span>  <span class="op">&gt;&gt;</span> extractPorts.tmp</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>	<span class="fu">cat</span> extractPorts.tmp<span class="kw">;</span> <span class="fu">rm</span> extractPorts.tmp</span></code></pre></div>
<h1 id="parsear-argumentos-de-un-script">Parsear argumentos de un
script</h1>
<p>Explico en detalle el procedimiento para lograr esto en mi artículo
<a href="../leer-argumentos-en-tu-script-bash">Leer argumentos en tu
script bash</a>:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadir mas opciones tipo --name)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Este bucle inicial permite mapear formato opcion larga a corta</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># que es la unica que entiende bash</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> arg <span class="kw">in</span> <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">shift</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="st">&quot;</span><span class="va">$arg</span><span class="st">&quot;</span> <span class="kw">in</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;--help&#39;</span><span class="kw">)</span>      <span class="bu">set</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span> <span class="st">&#39;-h&#39;</span>   <span class="cf">;;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">*</span><span class="kw">)</span>             <span class="bu">set</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$arg</span><span class="st">&quot;</span> <span class="cf">;;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">esac</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadir mas parametros a conveniencia en geopts y case</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">getopts</span> <span class="st">&quot;:h:&quot;</span> <span class="va">arg</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="va">$arg</span> <span class="kw">in</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="ss">h</span> <span class="kw">|</span> <span class="pp">*</span><span class="kw">)</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>            <span class="ex">showHelpPanel</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">;;</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">esac</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="bu">shift</span> <span class="va">$((</span> <span class="va">OPTIND</span> <span class="op">-</span> <span class="dv">1</span><span class="va">))</span></span></code></pre></div>
<h1
id="validar-que-un-parámetro-esta-en-un-rango-de-valores-validos-definidos-en-un-array">Validar
que un parámetro esta en un rango de valores validos definidos en un
array</h1>
<p>En otros lenguajes es mas sencillo pero en bash tenemos que utilizar
a veces hasta la imaginación para conseguir algo tan simple, aquí te
dejo el enfoque de como lo trato yo. Utilizo este acercamiento en mi
herramienta <a
href="https://github.com/s3r0s4pi3ns/ipharvest">ipharvest</a>:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set_mode()</span> <span class="kw">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">declare</span> <span class="at">-a</span> <span class="va">available_modes</span><span class="op">=</span><span class="va">(</span><span class="st">&quot;ipv4&quot;</span> <span class="st">&quot;ipv6&quot;</span> <span class="st">&quot;both&quot;</span><span class="va">)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">declare</span> <span class="at">-i</span> <span class="va">valid_mode</span><span class="op">=</span>0</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">selected_mode</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> mode <span class="kw">in</span> <span class="st">&quot;</span><span class="va">${available_modes</span><span class="op">[@]</span><span class="va">}</span><span class="st">&quot;</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$mode</span><span class="st">&quot;</span> <span class="ot">=</span> <span class="st">&quot;</span><span class="va">$selected_mode</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            <span class="va">MODE</span><span class="op">=</span><span class="va">$mode</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>            <span class="va">valid_mode</span><span class="op">=</span>1</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="va">$valid_mode</span> <span class="ot">-eq</span> 0 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;The selected mode </span><span class="va">$selected_mode</span><span class="st"> is invalid, allowed values are: </span><span class="va">${available_modes</span><span class="op">[*]</span><span class="va">}</span><span class="st">. The default mode </span><span class="va">$MODE</span><span class="st"> will be used instead&quot;</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h1 id="operaciones-con-arrays-asociativos">Operaciones con arrays
asociativos</h1>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Onicializar</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">declare</span> <span class="at">-A</span> <span class="va">mydict</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar multiples valores en una accion</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="va">mydict</span><span class="op">=</span><span class="va">(</span><span class="op">[</span>key1<span class="op">]</span><span class="va">=</span>1 <span class="op">[</span>key2<span class="op">]</span><span class="va">=</span>2 <span class="op">[</span>key3<span class="op">]</span><span class="va">=</span>3<span class="va">)</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar un elemento al final</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="va">mydict</span><span class="op">+=</span><span class="va">(</span>key4=4<span class="va">)</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener claves y valores</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">${mydict</span><span class="op">[@]</span><span class="va">}</span> <span class="co">#### Obtener todos los valores</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span> 2 1</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">${mydict</span><span class="op">[*]</span><span class="va">}</span>  <span class="co">###  Obtener todos los valores</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span> 2 1</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">${</span><span class="op">!</span><span class="va">mydict</span><span class="op">[*]</span><span class="va">}</span>  <span class="co">### Obtener todas las claves</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="ex">key3</span> key2 key1</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Validar si un elemento existe, &#39;abc&#39; puede ser cualquier otro valor</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Si el elemento existe retorna &#39;abc&#39; por lo tanto es verdadero</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Si no existe no retorna abc por lo que la siguiente operacion echo no se ejecuta</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> <span class="va">${mydict</span><span class="op">[</span>key<span class="op">]+</span>abc<span class="va">}</span> <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&#39;existe&#39;</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternativa</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprobar que no existe</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="ot">!</span> <span class="ot">-v</span> mydict[<span class="st">&quot;</span><span class="va">$key</span><span class="st">&quot;</span>] <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>	<span class="ex">//...</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Comprobar que si existe</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="ot">-v</span> mydict[<span class="st">&quot;</span><span class="va">$key</span><span class="st">&quot;</span>] <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>	<span class="ex">//...</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Borrar elemento</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="bu">unset</span> <span class="va">mydict[</span>key2<span class="op">]</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Numero de elementos en el array, usar prefijo #</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">${</span><span class="op">#</span><span class="va">STAR_PLAYERS</span><span class="op">[@]</span><span class="va">}</span></span></code></pre></div>
<h1 id="transformar-string-en-array">Transformar string en array</h1>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="va">names</span><span class="op">=</span><span class="st">&quot;Juanito Especialito Enrique Kiko&quot;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="va">array</span><span class="op">=</span><span class="va">($names)</span> <span class="co"># Esta transformacion usa IFS=&#39; &#39; como delimitador</span></span></code></pre></div>
<h1 id="convertir-string-multilinea-en-array">Convertir string
multilinea en array</h1>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bash utiliza la variable IFS que por defecto utiliza \n como separador</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Si quisieramos definir otro simplemente IFS=&lt;separator&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A su vez readarray inicializa la variable MAPFILE con los valores en este formato</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Esta funcionalidad solo esta disponible en bash 4+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="ex">readarray</span> <span class="at">-t</span> ip_addreses <span class="op">&lt;&lt;&lt;</span> <span class="st">&quot;192.168.1.1\n10.10.10.25\n67.89.133.11&quot;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ip <span class="kw">in</span> <span class="st">&quot;</span><span class="va">${ip_addreses</span><span class="op">[@]</span><span class="va">}</span><span class="st">&quot;</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="va">${IP_GEOLOCATION_DICTIONARY</span><span class="op">[</span><span class="va">$ip</span><span class="op">]+</span>exists<span class="va">}</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>          <span class="va">IP_GEOLOCATION_DICTIONARY</span><span class="op">[</span><span class="va">$ip</span><span class="op">]=</span><span class="va">$(</span><span class="ex">geolocate_ip</span> <span class="st">&quot;</span><span class="va">$ip</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">fi</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Soporte para versiones bash antiguas</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> arr=<span class="er">(</span><span class="kw">)</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> while IFS= read <span class="at">-r</span> ip<span class="kw">;</span> <span class="cf">do</span> <span class="va">arr</span><span class="op">+=</span><span class="va">(</span><span class="st">&quot;</span><span class="va">$ip</span><span class="st">&quot;</span><span class="va">)</span><span class="kw">;</span> <span class="cf">done</span> <span class="op">&lt;&lt;&lt;</span><span class="st">&quot;</span><span class="va">$ip_addreses</span><span class="st">&quot;</span></span></code></pre></div>
<h1 id="imprimir-texto-multilinea-con-sustitucion-de-variables">Imprimir
texto multilinea con sustitucion de variables</h1>
<p>La palabra clave elegida (EOF en el ejemplo) no debe contener
comillas si deseamos sustituir variables dentro:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">banner()</span> <span class="kw">{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span> <span class="op">&lt;&lt; EOF</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="st">___ _           _      _ _____</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="st"> | |_)__|_| /</span><span class="dt">\ </span><span class="st">|_)</span><span class="dt">\ </span><span class="st"> /|_(_  |</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="st">_|_|    | |/--</span><span class="dt">\|</span><span class="st"> </span><span class="dt">\ \/</span><span class="st"> |___) | v(</span><span class="va">${VERSION}</span><span class="st">)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h1 id="extraer-propiedades-de-un-archivo-.json">Extraer propiedades de
un archivo .json</h1>
<p>Despues de una larga lucha con chatGPT esta es la versión que me ha
funcionado correctamente con valores anidados en un json:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="va">json</span><span class="op">=</span><span class="st">&#39;{&quot;status&quot;:&quot;success&quot;,&quot;description&quot;:&quot;Data successfully received.&quot;,&quot;data&quot;:{&quot;geo&quot;:{&quot;host&quot;:&quot;74.220.199.8&quot;,&quot;ip&quot;:&quot;74.220.199.8&quot;,&quot;rdns&quot;:&quot;parking.hostmonster.com&quot;,&quot;asn&quot;:46606,&quot;isp&quot;:&quot;UNIFIEDLAYER-AS-1&quot;,&quot;country_name&quot;:&quot;United States&quot;,&quot;country_code&quot;:&quot;US&quot;,&quot;region_name&quot;:null,&quot;region_code&quot;:null,&quot;city&quot;:null,&quot;postal_code&quot;:null,&quot;continent_name&quot;:&quot;North America&quot;,&quot;continent_code&quot;:&quot;NA&quot;,&quot;latitude&quot;:37.751,&quot;longitude&quot;:-97.822,&quot;metro_code&quot;:null,&quot;timezone&quot;:&quot;America\/Chicago&quot;,&quot;datetime&quot;:&quot;2023-03-18 04:23:49&quot;}}}&#39;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># con jq disponible y queremos acceder a la propiedad status</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a> <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$json</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">jq</span> <span class="st">&#39;.status&#39;</span> <span class="co"># success</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Puro bash</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_json_property()</span> <span class="kw">{</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">json</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">prop</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$2</span><span class="st">&quot;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Usamos grep para matchear la propiedad a buscar</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">regex</span><span class="op">=</span><span class="st">&quot;</span><span class="dt">\&quot;</span><span class="va">${prop}</span><span class="dt">\&quot;</span><span class="st">:\s*([^,}]+)&quot;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">[[</span> <span class="va">$json</span> <span class="ot">=~</span> <span class="va">$regex</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">local</span> <span class="va">value</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${BASH_REMATCH</span><span class="op">[</span><span class="dv">1</span><span class="op">]</span><span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Si el valor es una string con comillas se las quitamos</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">[[</span> <span class="va">$value</span> <span class="ot">=~</span> <span class="pp">^</span><span class="dt">\&quot;</span><span class="op">(</span><span class="pp">.*</span><span class="op">)</span><span class="dt">\&quot;</span><span class="op">$</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">${BASH_REMATCH</span><span class="op">[</span><span class="dv">1</span><span class="op">]</span><span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$value</span><span class="st">&quot;</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Si no se encuentra nada devolvemos una cadena vacía para seguir la ejecución</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="ex">extract</span> json_property <span class="st">&quot;</span><span class="va">$json</span><span class="st">&quot;</span> <span class="st">&quot;latitude&quot;</span></span></code></pre></div>
<h1
id="extraer-propiedades-de-un-frontmatter-en-archivos-markdown">Extraer
propiedades de un frontmatter en archivos markdown</h1>
<p>Para generar los articulos de este blog utilizo esta función que me
permite extraer propiedades y aplicar unas transformaciones despues o
simplemente leer el dato, muy útil si trabajas con markdown:</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">### Estructura de frontmatter en un markdown para alojar metadatos</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ---</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># author: s3r0s4pi3ns</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># date: 2023-03-01</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># datetime: 2023-03-01T00:00:00.000Z</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># description: Si tenías la curiosidad de como se crean las herramientas de bash que te permiten pasar como parámetro opciones específicas este es tu # lugar</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># title: Definir argumentos en un script de bash</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">###</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> extract_frontmatter_property()</span> <span class="kw">{</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">markdown_file</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">property</span><span class="op">=</span><span class="va">$2</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="st">&quot;</span><span class="va">$markdown_file</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">frontmatter</span><span class="op">=</span><span class="va">$(</span><span class="fu">awk</span> <span class="st">&#39;/^---*$/{p=!p;next}p&#39;</span> <span class="st">&quot;</span><span class="va">$markdown_file</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$frontmatter</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="va">$GREP_COMMAND</span> <span class="at">-E</span> <span class="st">&quot;^</span><span class="va">${property}</span><span class="st">: (.*)&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/^[^:]*:\s*//&#39;</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&#39;&#39;</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplos</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="va">title</span><span class="op">=</span><span class="va">$(</span><span class="ex">extract_frontmatter_property</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="st">&quot;title&quot;</span><span class="va">)</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="va">date</span><span class="op">=</span><span class="va">$(</span><span class="ex">extract_frontmatter_property</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="st">&quot;date&quot;</span><span class="va">)</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="va">human_date</span><span class="op">=</span><span class="va">$(</span><span class="ex">extract_frontmatter_property</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="st">&quot;human_date&quot;</span><span class="va">)</span></span></code></pre></div>
<h1
id="reemplazar-espacios-en-blanco-por-un-caracter-definido">Reemplazar
espacios en blanco por un caracter definido</h1>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se reemplazaran por _</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="st">&#39;s/[[:space:]]\{1,\}/_/g&#39;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonus: Eliminar comillas dobles &quot;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="st">&#39;s/\&quot;//g&#39;</span></span></code></pre></div>
<h1
id="sacando-output-a-shell-en-lugar-de-guardar-un-archivo-con-wget">Sacando
output a shell en lugar de guardar un archivo con wget</h1>
<p>Al definir un output de <code>qO-</code> sin un redirector
<code>&gt;</code> va directamente a la shell:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="at">-qO-</span> https://example.com</span></code></pre></div>
<h1 id="convertir-texto-a-hexadecimal">Convertir texto a
hexadecimal</h1>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quitar el espacio inicial de &quot; %02x&quot;&#39; si lo queremos todo junto</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a> <span class="bu">echo</span> <span class="st">&quot;example&quot;</span> <span class="kw">|</span> <span class="fu">hexdump</span> <span class="at">-ve</span> <span class="st">&#39;1/1 &quot; %02x&quot;&#39;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="ex">65</span> 6a 65 6d 70 6c 6f 0a</span></code></pre></div>
<h1 id="fork-bomb">Fork bomb</h1>
<p><a href="https://en.wikipedia.org/wiki/Fork_bomb">Wikipedia
Fork_bomb</a> Yo cuando la vi por primera vez en el típico artículo
random, no la entendía, solo era una amalgama de caracteres en fila
india pero si la descomponemos vemos que es un simple función que se
llama asi misma recursivamente agotando los recursos del sistema.</p>
<h2 id="importantísimo">Importantísimo</h2>
<p>No la tires en tu PC de uso normal, hazlo en un entorno virtualizado
porque es muy probable que se te congele si tu sistema no tiene definido
un numero maximo de procesos. Los procesadores modernos tienen mitigado
esta movida pero nunca se sabe.</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">:()</span><span class="kw">{</span> <span class="bu">:</span><span class="kw">|</span><span class="bu">:</span><span class="kw">&amp;</span> <span class="kw">};</span><span class="bu">:</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Si sustitimos los ; por fork se puede entender como</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fork()</span> <span class="kw">{</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">fork</span> <span class="kw">|</span> <span class="ex">fork</span> <span class="kw">&amp;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="ex">fork</span></span></code></pre></div></section>
    </main>
  </body>
</html>
