<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Tu blog estatico con solo 80
lineas de bash, aprende a no depender de ningun CMS a la hora de crear
tu contenido" />
    <title>S3r0s4pi3ns - Construyendo un blog estatico con bash</title>
    <link rel="stylesheet" href="../../styles/normalize.css" />
    <link rel="stylesheet" href="../../styles/globals.css" />
    <link rel="stylesheet" href="../../styles/article.css" />
  </head>
  <body>
    <main>
      <div class="terminal">
        <pre>
          <span class="output" data-prompt="blog/2023/construyendo-un-blog-estatico-con-bash"><a class="terminal-link" href="/">cd &#36;HOME</a></span>
        </pre>
      </div>
      <article>
        <header>
          <h1>Construyendo un blog estatico con bash</h1>
        </header>
      </article>
      <section><h1 id="antes-de-empezar">Antes de empezar</h1>
<p>Si te importa un carajo como he construido esta basura puedes ir
directamente al código en el repositorio <a
href="https://github.com/s3r0s4pi3ns/bash-static-blog">https://github.com/s3r0s4pi3ns/bash-static-blog</a>
y ahorrarte toda esta fumada.</p>
<p><code>Se requiere que tengas conocimientos previos de:</code></p>
<ul>
<li><strong><em>Linux</em></strong></li>
<li><strong><em>Bash scripting</em></strong></li>
<li><strong><em>Docker &amp; Nginx (opcional)</em></strong></li>
</ul>
<h1 id="la-idea-inicial">La idea inicial</h1>
<p>Es 2023, mientras escribo este artículo semidesnudo, en el mundo
existen multitud de herramientas para construir sitios estáticos como <a
href="https://gohugo.io/">Hugo</a>, <a
href="https://jekyllrb.com/">Jekyll</a> o <a
href="https://astro.build/">Astro</a> que hacen un trabajo excelente. El
problema es mi intención minimalista inicial a la hora de querer
construir mi blog y es que estas herramientas o frameworks generan un
overload de información que me resulta incómoda de manejar para lo que
yo realmente quiero.</p>
<p>Llegué a crear un blog con estas 3 herramientas que he mencionado
usando un theme fancy super responsive pero algo me decía en mi
pechito</p>
<blockquote>
<p>Tío eres programador, montate algo tu mismo, reinventa la rueda
cabron</p>
</blockquote>
<p>Yo soy feliz con una estructura simple y repetitiva que me permita
generar contenido en markdown y transformarlo en html usable. Por eso
decidí montarme mi blog con bash y la ayuda del conversor <a
href="https://pandoc.org/">Pandoc</a> para darle un toque web de los
años 90 donde todo eran hipervínculos y punto pelota.</p>
<p>El resultado final es este blog que estás leyendo ahora mismo con un
javascript inexistente ¿XSS? eso que es.</p>
<h1 id="iniciando-el-camino">Iniciando el camino</h1>
<p>Llamadme persona extraña pero me gusta comentar el proceso mental
<em>(o retroceso)</em> que he tenido a la hora de construir este blog
estático y no enseñar el resultado final de primeras. Todo empezó con
una estructura de carpetas y archivos donde había apuntado algunas ideas
sueltas en el <code>README.md</code>:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> content</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 2023</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   │   ├── como-dejar-de-mirar-en-la-oscuridad.md</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   │   └── bash-para-payasos.md</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> test.sh</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> src</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> assets</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── images</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>       └── avatar.png</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> index.html</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> styles</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> globals.css</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> normalize.css</span></code></pre></div>
<p>La idea rudimentaria era alojar el contenido markdown dentro de la
carpeta <code>content</code> y sacarlo como output hacia
<code>src</code> que es la carpeta que mi servidor web va a ofrecer a
los amables usuarios de internet usando el script avanzado nivel
avengers <code>test.sh</code>. Este es el contenido del README.md en su
estado fetal:</p>
<h2 id="readme.md">README.md</h2>
<h3
id="se-puede-crear-un-sitio-tipo-blog-usando-la-herramienta-pandoc-y-un-par-de-comandos-de-bash">¿Se
puede crear un sitio tipo blog usando la herramienta pandoc y un par de
comandos de bash?</h3>
<p>Quizas si, voy a enumerar un par de features minimalistas. Digo
minimalista porque es el publico objetivo, algo liviano fuera de todo
tipo de artificios en el que solo se enfoque en una cosa, mostrar
contenido.</p>
<ul>
<li>Crear un directorio base de carpetas donde se movera el contenido al
directorio source</li>
<li>Multilenguaje (carpetas con el locale tipo es,en…)</li>
<li>Metadatos en formato .yml para la configuracion basica del blog</li>
<li>Metadatos para categorizar articulos</li>
<li>Makefile para abstraer las operaciones en un lenguaje humano</li>
<li>Template minimalista con html y css, nada de frameworks</li>
<li>Entorno docker con Nginx y Pandoc separados</li>
</ul>
<p>Requerimentos: pandoc yq(parseo yaml como jq para json) bash v4+</p>
<h2 id="que-he-terminado-de-ese-readme-inicial">Que he terminado de ese
README inicial</h2>
<p>Uno sabe como empieza pero no como acaba, de esas ideas que enumeré
en ese momento de retrolucidez extrema solo llegué a implementar:</p>
<ul>
<li>Crear un directorio base de carpetas donde se movera el contenido al
directorio source</li>
<li>Metadatos para categorizar articulos <em>(ni le llamo metadatos, el
frontmatter del markdown tipico)</em></li>
<li>Template minimalista con html y css, nada de frameworks</li>
<li>Entorno docker con Nginx y Pandoc separados</li>
</ul>
<h1 id="el-script">El script</h1>
<p>El script que ahora se nombra <code>generate.sh</code> ha tenido
trescientos mil cambios y no se parece en nada con el que empecé, a
medida que iba descubriendo cosas por el camino, bloqueos mentales y
todo tipo de miserias humanas del primer mundo llegué a una versión
final nada mal.</p>
<p>En mi mente este código tenia que realizar 2 operaciones importantes:
Transformar el markdown en html, Generar un indice de artículos en mi
index html</p>
<p>Vamos a trocearlo un poquito:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># REMINDER OUTPUT STYLES FOR SYNTAX HIGHLIGHT pandoc --highlight-style=zenburn ./content/2023/definir-argumentos-script-de-bash.md -s -o readme2.html</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="va">GREP_COMMAND</span><span class="op">=</span><span class="st">&#39;grep&#39;</span> <span class="co"># GNU Linux grep command by default</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> is_macOs()</span> <span class="kw">{</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">[[</span> <span class="st">&quot;</span><span class="va">$OSTYPE</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&#39;darwin&#39;</span><span class="pp">*</span> <span class="kw">]]</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">is_macOs</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">GREP_COMMAND</span><span class="op">=</span><span class="st">&#39;ggrep&#39;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ot">! </span><span class="bu">command</span> <span class="at">-v</span> <span class="st">&quot;</span><span class="va">$GREP_COMMAND</span><span class="st">&quot;</span> <span class="op">&gt;</span>/dev/null <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;GNU grep is required. Install it with &#39;brew install grep&#39;&quot;</span> <span class="op">&gt;&amp;</span><span class="dv">2</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exit</span> 1</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<p>De momento lo que vemos no tiene nada que ver con un blog, yo utilizo
un Macbook para mi día a día y descubres que comandos que usas en un
linux tipo <code>sed</code> o <code>grep</code> no funcionan de la misma
manera por eso tengo que comprobar si el sistema que ejecuta el script
es un mac y utilizar el comando apropiado que en mi caso serà
<code>ggrep</code> el cual tiene el mismo comportamiento que el nativo
de Linux.</p>
<p>El comentario REMINDER tiene historia ya que casi abandono este
proyecto por no conseguir que pandoc me aplicara los estilos de syntax
highlighting en el html generado cuando usaba la opción –standalone. No
conseguía dar con la tecla ni leyendo la documentación oficial así que
se me ocurrió transformar un markdown de prueba a un html cualquiera
donde aplicara un theme de syntax highlighting via –highlight-style ya
que de esta forma pandoc aplica los estilos en linea en el html
generado.</p>
<p>Si, es triste, para obtener un theme de resaltado tengo que extraerlo
como si fuera carbón pero lo bueno es que solo tengo que hacerlo una vez
si ya tengo decidido que theme usar <em>(zenburn)</em>.</p>
<h2 id="generando-html-desde-markdown-con-pandoc">Generando html desde
markdown con pandoc</h2>
<p>Si tuviera que picarme yo un parseador de markdown si que estaría
loco, así que haciendo un par de búsquedas parece que <a
href="https://pandoc.org/">Pandoc</a> era el way to go aceptado por la
industria en general</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="va">CURRENT_DIR</span><span class="op">=</span><span class="va">$(</span><span class="fu">dirname</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">readlink</span> <span class="at">-f</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$BASH_SOURCE</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span><span class="va">)</span> <span class="co"># No te rayes, usa $(pwd)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="va">MARKDOWN_FILES</span><span class="op">=</span><span class="va">$(</span><span class="fu">find</span> <span class="st">&quot;</span><span class="va">$CURRENT_DIR</span><span class="st">/content&quot;</span> <span class="at">-type</span> f <span class="at">-iname</span> <span class="st">&#39;*.md&#39;</span> <span class="at">-print</span> <span class="kw">|</span> <span class="fu">xargs</span> <span class="at">-0</span><span class="va">)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> generate_html_from_markdown()</span> <span class="kw">{</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">markdown_path</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">base_dir</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$markdown_path</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s|/content/.*||&#39;</span><span class="va">)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">templates_path</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$base_dir</span><span class="st">/content/templates&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">html_path</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$markdown_path</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s|.*/content/||&#39;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/\.md$/.html/&#39;</span><span class="va">)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">output_path</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$base_dir</span><span class="st">/src/blog/</span><span class="va">$html_path</span><span class="st">&quot;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">dirname</span> <span class="st">&quot;</span><span class="va">$output_path</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">pandoc</span> <span class="at">--read</span><span class="op">=</span>markdown <span class="at">--table-of-contents</span> <span class="at">--toc-depth</span><span class="op">=</span>2 <span class="at">--preserve-tabs</span> <span class="at">--standalone</span> <span class="at">--template</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$templates_path</span><span class="st">&quot;</span>/article.html <span class="at">--listings</span> <span class="st">&quot;</span><span class="va">$markdown_path</span><span class="st">&quot;</span> <span class="at">--highlight-style</span><span class="op">=</span>zenburn <span class="at">-o</span> <span class="st">&quot;</span><span class="va">$output_path</span><span class="st">&quot;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;Generated html from article </span><span class="va">$(</span><span class="fu">dirname</span> <span class="st">&quot;</span><span class="va">$markdown_path</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Este par de líneas es el core, la función que se encarga de recibir
por parámetro el path absoluto donde se encuentra un archivo markdown
para posteriormente, despues de aplicar unos filtros y extraer cierta
información, convertirlo en html.</p>
<p>Aquí entra el juego el sistema de templates que incluye pandoc y es
que puedes proveerle de un archivo base donde puedes inyectarle
variables con la sintaxis <code>$variable$</code>. Estas variables las
obtiene del frontmatter de markdown <em>(a excepción de <span
class="math inline"><em>b</em><em>o</em><em>d</em><em>y</em></span> que
es el contenido markdown)</em>, todos los artículos que genere a partir
de ahora usaran el siguiente <code>article.html</code> como base:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html</span> <span class="er">lang</span><span class="ot">=</span><span class="st">&quot;es&quot;</span><span class="kw">&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">charset</span><span class="ot">=</span><span class="st">&quot;UTF-8&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">http-equiv</span><span class="ot">=</span><span class="st">&quot;X-UA-Compatible&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;IE=edge&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">name</span><span class="ot">=</span><span class="st">&quot;viewport&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">name</span><span class="ot">=</span><span class="st">&quot;description&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;$description$&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;title&gt;</span>S3r0s4pi3ns - $title$<span class="kw">&lt;/title&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">&quot;stylesheet&quot;</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;../../styles/normalize.css&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">&quot;stylesheet&quot;</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;../../styles/globals.css&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">&quot;stylesheet&quot;</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;../../styles/article.css&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;main&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;terminal&quot;</span><span class="kw">&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;pre&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;span</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;output&quot;</span> <span class="er">data-prompt</span><span class="ot">=</span><span class="st">&quot;$path$&quot;</span><span class="kw">&gt;&lt;a</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;terminal-link&quot;</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;/&quot;</span><span class="kw">&gt;</span>cd <span class="dv">&amp;#36;</span>HOME<span class="kw">&lt;/a&gt;&lt;/span&gt;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/pre&gt;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;article&gt;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;header&gt;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;h1&gt;</span>$title$<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/header&gt;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/article&gt;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;section&gt;</span>$body$<span class="kw">&lt;/section&gt;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/main&gt;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<h2 id="iteración-de-archivos-markdown-para-generar-el-html">Iteración
de archivos markdown para generar el html</h2>
<p>De forma natural la siguiente función que visualizamos es la de
iterarar sobre nuestra lista de archivos markdown que existan en la
carpeta <code>content</code>, utilizarla es sencillo:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> generate_html_articles()</span> <span class="kw">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">markdown_files</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">IFS</span><span class="op">=</span> <span class="bu">read</span> <span class="at">-r</span>  <span class="va">markdown_file</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">generate_html_from_markdown</span> <span class="st">&quot;</span><span class="va">$markdown_file</span><span class="st">&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">&quot;</span><span class="va">$markdown_files</span><span class="st">&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Y ya podemos hacer que la magia computacional suceda en una linea
corta y directa, recordemos que <code>$MARKDOWN_FILES</code> lo
obtenemos del comando <code>find</code> en el inicio del script:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="va">MARKDOWN_FILES</span><span class="op">=</span><span class="va">$(</span><span class="fu">find</span> <span class="st">&quot;</span><span class="va">$CURRENT_DIR</span><span class="st">/content&quot;</span> <span class="at">-type</span> f <span class="at">-iname</span> <span class="st">&#39;*.md&#39;</span> <span class="at">-print</span> <span class="kw">|</span> <span class="fu">xargs</span> <span class="at">-0</span><span class="va">)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">generate_html_articles</span> <span class="st">&quot;</span><span class="va">$MARKDOWN_FILES</span><span class="st">&quot;</span></span></code></pre></div>
<h2
id="construyendo-el-índice-de-artículos-cada-vez-que-lanzamos-el-script">Construyendo
el índice de artículos cada vez que lanzamos el script</h2>
<p>Una de las partes que mas me ha dado el coñazo sin duda, fui feliz
durante unos instantes cuando conseguí transformar el markdown y sacarlo
como output a <code>src</code> hasta que me acordé que mi
<code>index.html</code> había que actualizarlo de forma manual para
reflejar los nuevos artículos. Me puse manos a la obra despues de
tomarme un café bastante amargo y frio . Antes de empezar necesitaba
unos cuantos datos importantes como era el título, la fecha de
publicación, etc. Esta información la tengo en el frontmatter del
archivo markdown así que vamos a combinar <code>awk</code> y
<code>sed</code> para el procesamiento de texto definitivo.</p>
<p>Cree una función para realizar exclusivamente esta tarea que
recibiera 2 parámetros, el archivo markdown y la propiedad a buscar:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> extract_frontmatter_property()</span> <span class="kw">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">markdown_file</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">property</span><span class="op">=</span><span class="va">$2</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="st">&quot;</span><span class="va">$markdown_file</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">frontmatter</span><span class="op">=</span><span class="va">$(</span><span class="fu">awk</span> <span class="st">&#39;/^---*$/{p=!p;next}p&#39;</span> <span class="st">&quot;</span><span class="va">$markdown_file</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$frontmatter</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="va">$GREP_COMMAND</span> <span class="at">-E</span> <span class="st">&quot;^</span><span class="va">${property}</span><span class="st">: (.*)&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/^[^:]*:\s*//&#39;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&#39;&#39;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Voy a intentar desenroscar un poco el lenguaje críptico que usan
estos comandos de procesamiento de texto de bash:</p>
<p><code>awk /^---\*$/{p=!p;next}</code></p>
<p><code>/^---\*$/:</code> Esta expresión regular busca las líneas
típicas de un frontmatter de markdown —, he añadido un * por si hubiera
mas de 3 pero en realidad no debería.</p>
<p><code>{p=!p;next}</code>: Esto es propio de awk, es como un bucle
donde p es una expresión booleana la cual es true si la linea a procesar
coincide con la expresion regular anterior. Mi objetivo principal es
obtener la información del frontmatter que se encuentra entre
<code>--- data ---</code> por lo que me esta procesando las líneas hasta
que se encuentre la siguiente — que sería la última y define el fin de
los metadatos del markdown.</p>
<p><code>echo "$frontmatter" | $GREP_COMMAND -E "^${property}: (.*)" | sed 's/^[^:]*:\s*//'</code></p>
<p>Ya una vez tengo el frontmatter y he guardado el resultado de
<code>awk</code> en la variable <code>$frontmatter</code> esta expresión
nos permite obtener el valor de una propiedad especifica del mismo,
<code>sed 's/^[^:]*:\s*//'</code> elimina la propiedad para que solo me
devuelva el valor, por ejemplo:</p>
<p><code>title: titulazo para el articulo</code> se convierte en
<code>titulazo para el articulo</code></p>
<h3
id="extrayendo-el-frontmatter-y-generando-un-índice-de-artículos-aceptable">Extrayendo
el frontmatter y generando un índice de artículos aceptable</h3>
<p>Una vez en la recta final, ya disponemos de todas las herramientas
necesarias para generar nuestro índice de artículos cada vez que
lanzemos el script y generemos contenido desde nuestra carpeta maestra
<code>content</code></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> generate_blog_index()</span> <span class="kw">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">articles</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">index_html_file</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$CURRENT_DIR</span><span class="st">/src/index.html&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert the updated article list</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">html</span><span class="op">=</span><span class="st">&#39;&#39;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">IFS</span><span class="op">=</span> <span class="bu">read</span> <span class="at">-r</span>  <span class="va">file</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="va">title</span><span class="op">=</span><span class="va">$(</span><span class="ex">extract_frontmatter_property</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="st">&quot;title&quot;</span><span class="va">)</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="va">date</span><span class="op">=</span><span class="va">$(</span><span class="ex">extract_frontmatter_property</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="st">&quot;date&quot;</span><span class="va">)</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="va">human_date</span><span class="op">=</span><span class="va">$(</span><span class="ex">extract_frontmatter_property</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="st">&quot;human_date&quot;</span><span class="va">)</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">year</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$date</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="va">$GREP_COMMAND</span> <span class="at">-o</span> <span class="st">&#39;[0-9]\{4\}&#39;</span><span class="va">)</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            <span class="va">path</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;/blog/</span><span class="va">$year</span><span class="st">/</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/\.md$//&#39;</span><span class="va">)</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            <span class="va">html</span><span class="op">+=</span><span class="st">&quot;&lt;li&gt;&lt;a href=</span><span class="dt">\&quot;</span><span class="va">$path</span><span class="dt">\&quot;</span><span class="st">&gt;</span><span class="va">$title</span><span class="st">&lt;/a&gt;&lt;span class=</span><span class="dt">\&quot;</span><span class="st">date</span><span class="dt">\&quot;</span><span class="st">&gt;</span><span class="va">$human_date</span><span class="st">&lt;/span&gt;&lt;/li&gt;&quot;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">&quot;</span><span class="va">$articles</span><span class="st">&quot;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sed</span> <span class="at">-i</span> <span class="st">&#39;&#39;</span> <span class="at">-e</span> <span class="st">&quot;/&lt;!-- START --&gt;/,/&lt;!-- END --&gt;/c</span><span class="dt">\\</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;!-- START --&gt;</span><span class="dt">\\</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="va">$html</span><span class="dt">\\</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;!-- END --&gt;&quot;</span> <span class="st">&quot;</span><span class="va">$index_html_file</span><span class="st">&quot;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Aquí la clave esta en las líneas START Y END ya que las utilizo para
borrar el contenido que existe entre ellas e insertar el nuevo con el
comando <code>sed</code> por lo que siempre tendre un nuevo y fresco
índice listo para ser consumido, este es el <code>index.html</code>
versión básica donde sucederá toda la magia:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html</span> <span class="er">lang</span><span class="ot">=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">charset</span><span class="ot">=</span><span class="st">&quot;UTF-8&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">http-equiv</span><span class="ot">=</span><span class="st">&quot;X-UA-Compatible&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;IE=edge&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">name</span><span class="ot">=</span><span class="st">&quot;viewport&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;meta</span> <span class="er">name</span><span class="ot">=</span><span class="st">&quot;description&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">&quot;stylesheet&quot;</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;styles/normalize.css&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">&quot;stylesheet&quot;</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;styles/globals.css&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;link</span> <span class="er">rel</span><span class="ot">=</span><span class="st">&quot;stylesheet&quot;</span> <span class="er">href</span><span class="ot">=</span><span class="st">&quot;styles/index.css&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;title&gt;</span>s3r0s4pi3ns - Blog<span class="kw">&lt;/title&gt;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;main&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;section&gt;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;recent-articles&quot;</span><span class="kw">&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;ul&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            <span class="co">&lt;!-- START --&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="co">&lt;!-- </span><span class="re">END</span><span class="co"> --&gt;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>          <span class="kw">&lt;/ul&gt;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;/div&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>      <span class="kw">&lt;/section&gt;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/main&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<h1 id="resultado-final-del-script">Resultado final del script</h1>
<p>Uniendo todas las piezas de este lego de aliexpress nos queda algo
liviano de 81 lineas que podemos utilizar para empezar a generar
contenido como locos, la parte clave son las llamadas a las funciones
justo al final del script donde primero generamos nuestros artículos y
despues el índice:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># REMINDER OUTPUT STYLES FOR SYNTAX HIGHLIGHT pandoc --highlight-style=zenburn ./content/2023/definir-argumentos-script-de-bash.md -s -o readme2.html</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="va">GREP_COMMAND</span><span class="op">=</span><span class="st">&#39;grep&#39;</span> <span class="co"># GNU Linux grep command by default</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> is_macOs()</span> <span class="kw">{</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">[[</span> <span class="st">&quot;</span><span class="va">$OSTYPE</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&#39;darwin&#39;</span><span class="pp">*</span> <span class="kw">]]</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ex">is_macOs</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">GREP_COMMAND</span><span class="op">=</span><span class="st">&#39;ggrep&#39;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ot">! </span><span class="bu">command</span> <span class="at">-v</span> <span class="st">&quot;</span><span class="va">$GREP_COMMAND</span><span class="st">&quot;</span> <span class="op">&gt;</span>/dev/null <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;GNU grep is required. Install it with &#39;brew install grep&#39;&quot;</span> <span class="op">&gt;&amp;</span><span class="dv">2</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">exit</span> 1</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="va">CURRENT_DIR</span><span class="op">=</span><span class="va">$(</span><span class="fu">dirname</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">readlink</span> <span class="at">-f</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$BASH_SOURCE</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="va">MARKDOWN_FILES</span><span class="op">=</span><span class="va">$(</span><span class="fu">find</span> <span class="st">&quot;</span><span class="va">$CURRENT_DIR</span><span class="st">/content&quot;</span> <span class="at">-type</span> f <span class="at">-iname</span> <span class="st">&#39;*.md&#39;</span> <span class="at">-print</span> <span class="kw">|</span> <span class="fu">xargs</span> <span class="at">-0</span><span class="va">)</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> generate_html_from_markdown()</span> <span class="kw">{</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">markdown_path</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">base_dir</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$markdown_path</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s|/content/.*||&#39;</span><span class="va">)</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">templates_path</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$base_dir</span><span class="st">/content/templates&quot;</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">html_path</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$markdown_path</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s|.*/content/||&#39;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/\.md$/.html/&#39;</span><span class="va">)</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">output_path</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$base_dir</span><span class="st">/src/blog/</span><span class="va">$html_path</span><span class="st">&quot;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$(</span><span class="fu">dirname</span> <span class="st">&quot;</span><span class="va">$output_path</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="ex">pandoc</span> <span class="at">--read</span><span class="op">=</span>markdown <span class="at">--table-of-contents</span> <span class="at">--toc-depth</span><span class="op">=</span>2 <span class="at">--preserve-tabs</span> <span class="at">--standalone</span> <span class="at">--template</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$templates_path</span><span class="st">&quot;</span>/article.html <span class="at">--listings</span> <span class="st">&quot;</span><span class="va">$markdown_path</span><span class="st">&quot;</span> <span class="at">--highlight-style</span><span class="op">=</span>zenburn <span class="at">-o</span> <span class="st">&quot;</span><span class="va">$output_path</span><span class="st">&quot;</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;Generated html from article </span><span class="va">$(</span><span class="fu">dirname</span> <span class="st">&quot;</span><span class="va">$markdown_path</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> generate_html_articles()</span> <span class="kw">{</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">markdown_files</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">IFS</span><span class="op">=</span> <span class="bu">read</span> <span class="at">-r</span>  <span class="va">markdown_file</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>        <span class="ex">generate_html_from_markdown</span> <span class="st">&quot;</span><span class="va">$markdown_file</span><span class="st">&quot;</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">&quot;</span><span class="va">$markdown_files</span><span class="st">&quot;</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> generate_blog_index()</span> <span class="kw">{</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">articles</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">index_html_file</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$CURRENT_DIR</span><span class="st">/src/index.html&quot;</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert the updated article list</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">html</span><span class="op">=</span><span class="st">&#39;&#39;</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">IFS</span><span class="op">=</span> <span class="bu">read</span> <span class="at">-r</span>  <span class="va">file</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>            <span class="va">title</span><span class="op">=</span><span class="va">$(</span><span class="ex">extract_frontmatter_property</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="st">&quot;title&quot;</span><span class="va">)</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>            <span class="va">date</span><span class="op">=</span><span class="va">$(</span><span class="ex">extract_frontmatter_property</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="st">&quot;date&quot;</span><span class="va">)</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>            <span class="va">human_date</span><span class="op">=</span><span class="va">$(</span><span class="ex">extract_frontmatter_property</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="st">&quot;human_date&quot;</span><span class="va">)</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>            <span class="va">year</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$date</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="va">$GREP_COMMAND</span> <span class="at">-o</span> <span class="st">&#39;[0-9]\{4\}&#39;</span><span class="va">)</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>            <span class="va">path</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="st">&quot;/blog/</span><span class="va">$year</span><span class="st">/</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/\.md$//&#39;</span><span class="va">)</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>            <span class="va">html</span><span class="op">+=</span><span class="st">&quot;&lt;li&gt;&lt;a href=</span><span class="dt">\&quot;</span><span class="va">$path</span><span class="dt">\&quot;</span><span class="st">&gt;</span><span class="va">$title</span><span class="st">&lt;/a&gt;&lt;span class=</span><span class="dt">\&quot;</span><span class="st">date</span><span class="dt">\&quot;</span><span class="st">&gt;</span><span class="va">$human_date</span><span class="st">&lt;/span&gt;&lt;/li&gt;&quot;</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">&quot;</span><span class="va">$articles</span><span class="st">&quot;</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sed</span> <span class="at">-i</span> <span class="st">&#39;&#39;</span> <span class="at">-e</span> <span class="st">&quot;/&lt;!-- START --&gt;/,/&lt;!-- END --&gt;/c</span><span class="dt">\\</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;!-- START --&gt;</span><span class="dt">\\</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="st">    </span><span class="va">$html</span><span class="dt">\\</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;!-- END --&gt;&quot;</span> <span class="st">&quot;</span><span class="va">$index_html_file</span><span class="st">&quot;</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> extract_frontmatter_property()</span> <span class="kw">{</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">markdown_file</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">property</span><span class="op">=</span><span class="va">$2</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="st">&quot;</span><span class="va">$markdown_file</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>        <span class="va">frontmatter</span><span class="op">=</span><span class="va">$(</span><span class="fu">awk</span> <span class="st">&#39;/^---*$/{p=!p;next}p&#39;</span> <span class="st">&quot;</span><span class="va">$markdown_file</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$frontmatter</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="va">$GREP_COMMAND</span> <span class="at">-E</span> <span class="st">&quot;^</span><span class="va">${property}</span><span class="st">: (.*)&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/^[^:]*:\s*//&#39;</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&#39;&#39;</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="ex">generate_html_articles</span> <span class="st">&quot;</span><span class="va">$MARKDOWN_FILES</span><span class="st">&quot;</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="ex">generate_blog_index</span> <span class="st">&quot;</span><span class="va">$MARKDOWN_FILES</span><span class="st">&quot;</span></span></code></pre></div>
<h2
id="como-está-el-directorio-de-trabajo-después-de-todo-este-proceso">Como
está el directorio de trabajo después de todo este proceso</h2>
<p>Este camino que hemos recorrido ha expandido la estructura de
carpetas que teniamos anteriormente, una vez tengas las carpetas
<code>content</code> y <code>src</code> todo lo que queda es añadir html
y css para darle un toque mas bonito. He añadido unos estilos css que
solo se cargaran en el template de <code>article.html</code>, las
fuentes de forma local para evitar llamadas externas usando <a
href="https://transfonter.org/">https://transfonter.org/</a>.</p>
<p>Despues de lanzar un <code>bash generate.sh</code> se queda algo como
esto dependiendo del contenido markdown que dispongas claro:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> content</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── 2023</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   │   ├── blog-estatico-con-bash.md</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   │   └── definir-argumentos-script-de-bash.md</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── templates</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── article.html</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> generate.sh</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> src</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> assets</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── fonts</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Black.ttf</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Black.woff</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Black.woff2</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-BlackItalic.ttf</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-BlackItalic.woff</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-BlackItalic.woff2</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Bold.ttf</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Bold.woff</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Bold.woff2</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-BoldItalic.ttf</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-BoldItalic.woff</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-BoldItalic.woff2</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Hairline.ttf</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Hairline.woff</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Hairline.woff2</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-HairlineItalic.ttf</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-HairlineItalic.woff</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-HairlineItalic.woff2</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Italic.ttf</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Italic.woff</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Italic.woff2</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Light.ttf</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Light.woff</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Light.woff2</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-LightItalic.ttf</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-LightItalic.woff</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-LightItalic.woff2</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Regular.ttf</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   ├── Lato-Regular.woff</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   └── Lato-Regular.woff2</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── images</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>       └── avatar.png</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> blog</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── 2023</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>       ├── blog-estatico-con-bash.html</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>       └── definir-argumentos-script-de-bash.html</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> index.html</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> styles</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> article.css</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> globals.css</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> index.css</span></code></pre></div>
<h1 id="toque-gourmet-con-docker-y-nginx">Toque gourmet con Docker y
Nginx</h1>
<p>Para probar este sistemita estaba usando el típico e innigualable
<code>python3 -m http.server</code> dentro de <code>src</code> para
servir el contenido estático y ver si estaba funcionando todo como
debería. Date cuenta que el contenido de <code>src</code> lo puedes
subir a cualquier plataforma como por ejemplo <a
href="https://pages.github.com/">Github pages</a> y ya tendrías tu blog
funcionando, cada vez que quieras actualizarlo lanzas el script, vuelves
actualizar el repo y listo, solo son archivos estáticos html y css.</p>
<p>Para el toque gourmet especial, he decidido añadir un servidor nginx
usando <a href="https://www.docker.com/">Docker</a> ya que me permite
simular mi entorno de producción lo mas parecido posible. Me di cuenta
que la url se mostraba con la terminación en <strong>.html</strong> y se
ve un poco feo para una web moderna.</p>
<p>Yo creo que es mas agradable ver <code>/blog/articulo</code> que
<code>/blog/articulo.html</code> aunque realmente daría igual, nuestro
blog funciona y punto.</p>
<h2 id="definiendo-nuestra-configuración-de-nginx">Definiendo nuestra
configuración de Nginx</h2>
<p>Antes que nada me dispongo a crear la siguiente estructura de
carpetas en la raíz del proyecto:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> nginx</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── Dockerfile</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── config</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       ├── default.conf</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── nginx.conf</span></code></pre></div>
<h3 id="dockerfile">Dockerfile</h3>
<p>Mas sencillo imposible, descargamos la imagen que sea stable en el
momento de construir el contenedor y copiamos nuestros archivos de
configuración</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> nginx:stable</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> <span class="at">-p</span> /var/www/html <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">chown</span> nginx:nginx /var/www/html <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">chown</span> nginx /var/log/nginx/<span class="pp">*</span>.log</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> config/nginx.conf /etc/nginx/nginx.conf</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> config/default.conf /etc/nginx/conf.d/default.conf</span></code></pre></div>
<h3 id="default.conf">default.conf</h3>
<p>Esta es la configuración que utilizara nuestro servidor para un host
virtual en específico, veras el dominio <code>serosapiens.com</code>,
sustituyelo por el que te convenga. De forma local este valor da un poco
igual pero tenlo en cuenta a la hora de utilizar un servidor de
producción. He añadido algunas reglas de seguridad así como la regla de
redirección para archivos .html y conseguir esa url limpia:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">server</span> {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">listen</span> 80<span class="kw">;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">listen</span> <span class="pp">[</span><span class="ss">::</span><span class="pp">]</span>:80<span class="kw">;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#rewrite ^/(.*) https://serosapiens.com/$1 permanent;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">server_name</span> serosapiens.com www.serosapiens.com<span class="kw">;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">root</span> /var/www/html<span class="kw">;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">index</span> index.html index.htm<span class="kw">;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">error_log</span>  /var/log/nginx/serosapiens.com.error.log<span class="kw">;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">access_log</span> /var/log/nginx/serosapiens.com.access.log<span class="kw">;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">limit_req_status</span> 429<span class="kw">;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">limit_req</span> zone=limitreq burst=2 nodelay<span class="kw">;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">limit_conn</span> limitconn 30<span class="kw">;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="ex">location</span> / {</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">try_files</span> <span class="va">$uri</span> <span class="va">$uri</span>.html <span class="va">$uri</span>/ <span class="va">$uri</span>/index.html @html_extension<span class="kw">;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>        <span class="ex">proxy_set_header</span> Host <span class="va">$http_host</span><span class="kw">;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="ex">proxy_set_header</span> X-Forwarded-For <span class="va">$remote_addr</span><span class="kw">;</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>        <span class="ex">proxy_set_header</span> X-Scheme <span class="va">$scheme</span><span class="kw">;</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="ex">proxy_set_header</span> X-Forwarded-Proto <span class="va">$scheme</span><span class="kw">;</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        <span class="ex">proxy_set_header</span> X-Real-IP <span class="va">$remote_addr</span><span class="kw">;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        <span class="ex">proxy_http_version</span> 1.1<span class="kw">;</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="ex">proxy_set_header</span> Upgrade <span class="va">$http_upgrade</span><span class="kw">;</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        <span class="ex">proxy_set_header</span> Connection <span class="st">&quot;upgrade&quot;</span><span class="kw">;</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>        <span class="ex">proxy_next_upstream</span> error timeout http_502 http_503 http_504<span class="kw">;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="ex">location</span> @html_extension {</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">(</span><span class="ex">-f</span> <span class="va">$request_filename</span><span class="kw">)</span> <span class="kw">{</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>            <span class="ex">rewrite</span> ^/<span class="er">(</span><span class="bu">.</span><span class="pp">*</span><span class="kw">)</span><span class="ex">\.html</span><span class="er">(</span><span class="ex">\?</span><span class="kw">|</span><span class="ex">$</span><span class="kw">)</span> <span class="ex">/</span><span class="va">$1</span> permanent<span class="kw">;</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">404</span><span class="kw">;</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="ex">location</span> ~ /\.<span class="er">(</span><span class="ex">?!well-known</span><span class="kw">)</span><span class="bu">.</span><span class="pp">*</span> {</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        <span class="ex">deny</span> all<span class="kw">;</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="ex">location</span> ~<span class="pp">*</span> <span class="dt">\.</span><span class="er">(</span><span class="ex">js</span><span class="kw">|</span><span class="ex">css</span><span class="kw">|</span><span class="ex">png</span><span class="kw">|</span><span class="ex">jpg</span><span class="kw">|</span><span class="ex">jpeg</span><span class="kw">|</span><span class="ex">gif</span><span class="kw">|</span><span class="ex">ico</span><span class="kw">)</span><span class="ex">$</span> {</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>        <span class="ex">log_not_found</span> off<span class="kw">;</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        <span class="ex">add_header</span> <span class="st">&#39;Cache-Control&#39;</span> <span class="st">&#39;no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0&#39;</span><span class="kw">;</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        <span class="ex">expires</span> off<span class="kw">;</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gzip</span> on<span class="kw">;</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gzip_comp_level</span> 3<span class="kw">;</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gzip_types</span> text/plain text/css image/<span class="pp">*</span><span class="kw">;</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">(</span><span class="va">$request_method</span> !~ ^<span class="er">(</span><span class="ex">GET</span><span class="kw">|</span><span class="ex">HEAD</span><span class="kw">)</span><span class="ex">$</span> <span class="kw">)</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">{</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">405</span><span class="kw">;</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="co"># server {</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a><span class="co">#     listen 443 ssl http2;</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a><span class="co">#     listen [::]:443 ssl http2;</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a><span class="co">#     server_name serosapiens.com www.serosapiens.com;</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a><span class="co">#     root /var/www/html;</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a><span class="co">#     index index.html;</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="co">#     ssl_certificate /root/certs/serosapiens.com/serosapiens.com.crt;</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="co">#     ssl_certificate_key /root/certs/serosapiens.com/serosapiens.com.key;</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     ssl_dhparam /root/certs/serosapiens.com/dhparam4096.pem;</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="co">#     ssl_prefer_server_ciphers on;</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     ssl_session_cache shared:SSL:10m;</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     ssl_session_timeout 10m;</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     #ssl_stapling on;</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a><span class="co">#     #ssl_stapling_verify on;</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="co">#     #ssl_trusted_certificate /root/certs/serosapiens.com/serosapiens.com.crt;</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a><span class="co">#     location / {</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a><span class="co">#         try_files $uri $uri/ =404;</span></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a><span class="co">#         proxy_set_header Host $http_host;</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a><span class="co">#         proxy_set_header X-Real-IP $remote_addr;</span></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a><span class="co">#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="co">#         proxy_set_header X-Forwarded-Proto $scheme;</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a><span class="co"># 	     gzip_static on;</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a><span class="co">#     }</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a><span class="co">#   if ($request_method !~ ^(GET|HEAD)$ )</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="co">#   {</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a><span class="co">#     return 405;</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div>
<h3 id="nginx.conf">nginx.conf</h3>
<p>El archivo de configuración global para nginx, los parámetros aquí
descritos se aplican a todos los hosts virtuales que hayamos
definido</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">user</span> nginx<span class="kw">;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">worker_processes</span> auto<span class="kw">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">pid</span> /run/nginx.pid<span class="kw">;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">include</span> /etc/nginx/modules-enabled/<span class="pp">*</span>.conf<span class="kw">;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="ex">events</span> {</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>	<span class="ex">worker_connections</span> 768<span class="kw">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>	<span class="co"># multi_accept on;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="ex">http</span> {</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>	<span class="co">##</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>	<span class="co"># Basic Settings</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>	<span class="co">##</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>	<span class="co">#proxy_cache_path /var/www/serosapiens.com/cache/ keys_zone=one:1m max_size=500m inactive=24h use_temp_path=off;</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>	<span class="ex">sendfile</span> on<span class="kw">;</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>	<span class="ex">tcp_nopush</span> on<span class="kw">;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>	<span class="ex">types_hash_max_size</span> 2048<span class="kw">;</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>	<span class="ex">server_tokens</span> off<span class="kw">;</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>	<span class="ex">underscores_in_headers</span> on<span class="kw">;</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>	<span class="ex">limit_req_zone</span> <span class="va">$binary_remote_addr$uri</span> zone=limitreq:10m rate=1r/s<span class="kw">;</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>	<span class="ex">limit_conn_zone</span> <span class="va">$binary_remote_addr</span> zone=limitconn:10m<span class="kw">;</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="ex">add_header</span> X-Frame-Options <span class="st">&quot;SAMEORIGIN&quot;</span><span class="kw">;</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="ex">add_header</span> X-XSS-Protection <span class="st">&quot;1; mode=block&quot;</span><span class="kw">;</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="ex">add_header</span> X-Content-Type-Options <span class="st">&quot;nosniff&quot;</span><span class="kw">;</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    <span class="ex">add_header</span> Content-Security-Policy <span class="st">&quot;default-src &#39;self&#39;; upgrade-insecure-requests;&quot;</span><span class="kw">;</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="ex">add_header</span> X-Frame-Options <span class="st">&quot;DENY&quot;</span><span class="kw">;</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    <span class="ex">add_header</span> Referrer-Policy strict-origin-when-cross-origin<span class="kw">;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#add_header Strict-Transport-Security &#39;max-age=31536000; includeSubDomains; preload&#39;;</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>	<span class="ex">proxy_hide_header</span> X-Powered-By<span class="kw">;</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>	<span class="co">#fastcgi_hide_header X-Powered-By;</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>	<span class="ex">keepalive_timeout</span> 75<span class="kw">;</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># server_names_hash_bucket_size 64;</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>	<span class="co"># server_name_in_redirect off;</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>	<span class="ex">include</span> /etc/nginx/mime.types<span class="kw">;</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>	<span class="ex">default_type</span> application/octet-stream<span class="kw">;</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>	<span class="co">##</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>	<span class="co"># SSL Settings</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>	<span class="co">##</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>	<span class="ex">ssl_protocols</span> TLSv1.1 TLSv1.2<span class="kw">;</span> <span class="co">#TLSv1.3;  Dropping SSLv3, ref: POODLE</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>	<span class="ex">ssl_prefer_server_ciphers</span> on<span class="kw">;</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ssl_ciphers</span> <span class="st">&quot;EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA RC4 !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !MEDIUM !RC4&quot;</span><span class="kw">;</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>	<span class="ex">ssl_session_cache</span> shared:SSL:50m<span class="kw">;</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>	<span class="ex">ssl_session_timeout</span> 5m<span class="kw">;</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>	<span class="co">##</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>	<span class="co"># Logging Settings</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>	<span class="co">##</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>	<span class="ex">access_log</span> /var/log/nginx/access.log<span class="kw">;</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>	<span class="ex">error_log</span> /var/log/nginx/error.log<span class="kw">;</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>	<span class="co">##</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>	<span class="co"># Gzip Settings</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>	<span class="co">##</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a> 	<span class="fu">gzip</span>                on<span class="kw">;</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gzip_disable</span>        <span class="st">&quot;msie6&quot;</span><span class="kw">;</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gzip_vary</span>           on<span class="kw">;</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gunzip</span>              on<span class="kw">;</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gzip_proxied</span>        any<span class="kw">;</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gzip_comp_level</span>     9<span class="kw">;</span></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gzip_buffers</span>        16 8k<span class="kw">;</span></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gzip_http_version</span>   1.1<span class="kw">;</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gzip_min_length</span>     1000<span class="kw">;</span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gzip_types</span>          text/plain text/css application/json application/x-javascript application/javascript text/xml application/xml application/xml+rss text/javascript<span class="kw">;</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>	<span class="co">##</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>	<span class="co"># Virtual Host Configs</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>	<span class="co">##</span></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>	<span class="ex">include</span> /etc/nginx/conf.d/<span class="pp">*</span>.conf<span class="kw">;</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>	<span class="ex">include</span> /etc/nginx/sites-enabled/<span class="pp">*</span><span class="kw">;</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>    <span class="co">##Buffer policy</span></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>    <span class="ex">client_body_buffer_size</span> 1K<span class="kw">;</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>    <span class="ex">client_header_buffer_size</span> 1k<span class="kw">;</span></span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>    <span class="ex">client_max_body_size</span> 1k<span class="kw">;</span></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>    <span class="ex">large_client_header_buffers</span> 2 1k<span class="kw">;</span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>    <span class="co">##End buffer policy</span></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<h3 id="docker-compose.yml">docker-compose.yml</h3>
<p>Realmente este no hace falta pero para mi trabajar con
<code>docker-compose</code> se me hace más facil y me permite organizar
los contendores de una forma mas fácil e intuituiva:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;3.9&quot;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">server-network</span><span class="kw">:</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> bridge</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">nginx</span><span class="kw">:</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> ./nginx</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;nginx-blog-server&quot;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8888:80</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./src:/var/www/html</span></span></code></pre></div>
<h2
id="construyendo-y-levantando-nuestro-contenedor-de-nginx">Construyendo
y levantando nuestro contenedor de nginx</h2>
<p>Una vez hayas levantado la historia esta, visita el puerto que hayas
expuesto para el servicio nginx en el docker-compose que en mi caso es
el <strong>8888</strong> y deberías ver el contenido de <code>src</code>
en tu navegador web de confianza servido por un maravilloso nginx de
ultima generacion.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span> <span class="at">--build</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Vemos si esta todo up</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> ps</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="ex">NAME</span>                IMAGE                   COMMAND                  SERVICE             CREATED             STATUS              PORTS</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="ex">nginx-blog-server</span>   pandoc-showcase-nginx   <span class="st">&quot;/docker-entrypoint.…&quot;</span>   nginx               56 minutes ago      Up 56 minutes       0.0.0.0:8888-<span class="op">&gt;</span>80/tcp</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Leemos el log de nginx a ver si no ha habido algun error en el proceso</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> logs nginx</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="ex">nginx-blog-server</span>  <span class="kw">|</span> <span class="ex">/docker-entrypoint.sh:</span> /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="ex">nginx-blog-server</span>  <span class="kw">|</span> <span class="ex">/docker-entrypoint.sh:</span> Looking for shell scripts in /docker-entrypoint.d/</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="ex">nginx-blog-server</span>  <span class="kw">|</span> <span class="ex">/docker-entrypoint.sh:</span> Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="ex">nginx-blog-server</span>  <span class="kw">|</span> <span class="ex">10-listen-on-ipv6-by-default.sh:</span> info: Getting the checksum of /etc/nginx/conf.d/default.conf</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="ex">nginx-blog-server</span>  <span class="kw">|</span> <span class="ex">10-listen-on-ipv6-by-default.sh:</span> info: /etc/nginx/conf.d/default.conf differs from the packaged version</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="ex">nginx-blog-server</span>  <span class="kw">|</span> <span class="ex">/docker-entrypoint.sh:</span> Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="ex">nginx-blog-server</span>  <span class="kw">|</span> <span class="ex">/docker-entrypoint.sh:</span> Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="ex">nginx-blog-server</span>  <span class="kw">|</span> <span class="ex">/docker-entrypoint.sh:</span> Configuration complete<span class="kw">;</span> <span class="ex">ready</span> for start up</span></code></pre></div>
<h1 id="imagen-docker-de-pandoc">Imagen docker de pandoc</h1>
<p>Por circunstancias de la vida, la imagen de Docker oficial para
pandoc a día de hoy no tiene soporte para arm64 y tengo que instalarlo
en mi pc pero si tu tienes una arquitectura amd64 o x86 puedes aplicar
este bloque a tu docker-compose y utilizarlo como servicio sin tener que
ensuciar tu sistema:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;3.9&quot;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">server-network</span><span class="kw">:</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">driver</span><span class="kw">:</span><span class="at"> bridge</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">nginx</span><span class="kw">:</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> ./nginx</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;nginx-blog-server&quot;</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8888:80</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">restart</span><span class="kw">:</span><span class="at"> unless-stopped</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./src:/var/www/html</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">pandoc</span><span class="kw">:</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> pandoc-generator</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">image</span><span class="kw">:</span><span class="at"> pandoc/core:3.1.1.0</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> ./content:/content</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> ./src:/src</span></span></code></pre></div>
<p>El único cambio que debemos hacer es en el script
<code>generate.sh</code> donde en lugar de llamar al comando pandoc, lo
ejecutamos desde el contenedor de docker:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> exec <span class="op">&lt;</span>service_name<span class="op">&gt;</span> <span class="op">&lt;</span>command<span class="op">&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> exec pandoc <span class="at">--read</span><span class="op">=</span>markdown <span class="at">--table-of-contents</span> <span class="at">--toc-depth</span><span class="op">=</span>2 <span class="at">--preserve-tabs</span> <span class="at">--standalone</span> <span class="at">--template</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$templates_path</span><span class="st">&quot;</span>/article.html <span class="at">--listings</span> <span class="st">&quot;</span><span class="va">$markdown_path</span><span class="st">&quot;</span> <span class="at">--highlight-style</span><span class="op">=</span>zenburn <span class="at">-o</span> <span class="st">&quot;</span><span class="va">$output_path</span><span class="st">&quot;</span></span></code></pre></div>
<h1 id="conclusiones-finales">Conclusiones finales</h1>
<p>Como borrador inicial me ha parecido suficiente para lanzar mi
contenido al mundo a través del formato blog, como podemos comprobar, si
tenemos los conocimientos adecuados podemos tener un poco de diversión
creando nuestras propias movidas aunque reinventemos la rueda de nuevo.
Mi intención era puramente individual y no tenía pensado crearlo como
una herramienta que pueda utilizarse a gran escala pero aquí algunas
mejoras que podríamos implementarle:</p>
<ul>
<li>Archivo de configuración .yml para definir carpetas, templates,
etc</li>
<li>i18n para el soporte de múltiples idiomas (traducciones automáticas
en el proceso de generación)</li>
<li>Makefile para abstraer ciertas operaciones (make articles, make
template, bla bla…)</li>
</ul>
<p>Seguro que hay muchas cosas mas para hacerle, como todo en esta vida,
el cambio es la unica constante y es posible que en el paso de este año
haya añadido algunas mejoras a este pequeño generador de contenido
estático y tenga que crear un nuevo post.</p>
<p>Si has llegado hasta aquí vaya puto valiente eres,
gracias.</p></section>
    </main>
  </body>
</html>
